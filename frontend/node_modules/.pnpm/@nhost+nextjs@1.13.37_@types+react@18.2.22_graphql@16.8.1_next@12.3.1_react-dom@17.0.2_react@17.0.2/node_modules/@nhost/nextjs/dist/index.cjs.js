"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const i=require("@nhost/react");require("isomorphic-unfetch");const c=require("js-cookie"),k=require("xstate/lib/waitFor"),h="nhostSession",d=e=>{const t=e&&"auth"in e?e.auth.getSession():e;if(!t){c.remove(h);return}const{refreshToken:r,...n}=t,o=new Date;o.setSeconds(o.getSeconds()+t.accessTokenExpiresIn-60),c.set(h,JSON.stringify(n),{sameSite:"strict",expires:o})},T=async(e,t)=>{let r;typeof e=="string"?(console.warn("Deprecation Notice: Backend URL is no longer supported. Please use subdomain + region or individual service URLs."),r={backendUrl:e}):r={...e};const n=new i.VanillaNhostClient({...r,clientStorageType:"custom",clientStorage:{getItem:s=>{var g;const u=s===i.NHOST_REFRESH_TOKEN_KEY?"refreshToken":s,S=t.query[u],l=(g=c.get(s))!=null?g:null,p=t.req.cookies[s];return typeof S=="string"?S:l!=null?l:p},setItem:(s,u)=>{c.set(s,u,{httpOnly:!1,sameSite:"strict",expires:30})},removeItem:s=>{c.remove(s)}},start:!1,autoRefreshToken:!1,autoSignIn:!0}),o=t.req.cookies[h],a=t.req.cookies[i.NHOST_REFRESH_TOKEN_KEY],N=o&&a&&{...JSON.parse(o),refreshToken:a};return n.auth.client.start({initialSession:N}),await k.waitFor(n.auth.client.interpreter,s=>!s.hasTag("loading")),n},y=async(e,t)=>{const r=await T(e,t),{accessToken:n,refreshToken:o,user:a}=r.auth.client.interpreter.getSnapshot().context;return r.auth.isAuthenticated()?{accessToken:n.value,accessTokenExpiresIn:(n.expiresAt.getTime()-Date.now())/1e3,refreshToken:o.value,user:a}:null},O=i.NhostProvider,f=typeof window!="undefined";class v extends i.NhostClient{constructor(t){super({...t,autoSignIn:f&&t.autoSignIn,autoRefreshToken:f&&t.autoRefreshToken,clientStorageType:"cookie"}),this.auth.onAuthStateChanged(()=>{d(this)}),this.auth.onTokenChanged(d)}}exports.NhostClient=v;exports.NhostNextProvider=O;exports.createServerSideClient=T;exports.getNhostSession=y;Object.keys(i).forEach(e=>{e!=="default"&&!Object.prototype.hasOwnProperty.call(exports,e)&&Object.defineProperty(exports,e,{enumerable:!0,get:()=>i[e]})});
//# sourceMappingURL=index.cjs.js.map
