"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("@nhost/nhost-js"),p=require("react"),t=require("@xstate/react"),O=require("jwt-decode"),y=g.NhostClient;class k extends y{constructor(e){super({...e,start:!1})}}const v=p.createContext({}),A=({nhost:s,initial:e,...n})=>{const u=t.useInterpret(s.auth.client.machine,{devTools:s.devTools});s.auth.client.start({interpreter:u,initialSession:e,devTools:s.devTools});const S=p.useRef(!0);return p.useEffect(()=>{S.current?S.current=!1:e&&u.send("SESSION_UPDATE",{data:{session:e}})},[e,u]),p.createElement(v.Provider,{value:s},n.children)},N=A,P=()=>{var n;const e=(n=p.useContext(v).auth)==null?void 0:n.client.interpreter;if(!e)throw Error("Could not find the Nhost auth client. Did you wrap your app in <NhostProvider />?");return e},x=()=>{const s=P();return t.useSelector(s,e=>({isAuthenticated:e.matches({authentication:"signedIn"}),isLoading:e.hasTag("loading"),error:e.context.errors.authentication||null,isError:e.matches({authentication:{signedOut:"failed"}}),connectionAttempts:e.context.importTokenAttempts}),(e,n)=>e.isAuthenticated===n.isAuthenticated&&e.isLoading===n.isLoading&&e.connectionAttempts===n.connectionAttempts)};function M({children:s}){const{isAuthenticated:e}=x();return e?p.createElement(p.Fragment,null,s):null}function R({children:s}){const{isAuthenticated:e}=x();return e?null:p.createElement(p.Fragment,null,s)}const U=()=>{const s=P();return t.useSelector(s,e=>e.context.accessToken.value)},f=()=>p.useContext(v),L=()=>{const s=f(),[e,n]=p.useState(null),u=!e,S=!!e,[a,h]=p.useState(!1);return{add:async o=>{h(!0);const r=await g.addSecurityKeyPromise(s.auth.client,o),{error:c}=r;return c&&n(c),h(!1),r},isLoading:a,isSuccess:u,isError:S,error:e}},D=()=>{const s=P(),[e,n]=p.useState(!!s.status&&s.getSnapshot().matches({authentication:"signedIn"}));return p.useEffect(()=>s.subscribe(S=>{const a=S.matches({authentication:"signedIn"});n(a)}).unsubscribe,[s]),e};function K(s){const e=f(),n=p.useMemo(()=>g.createChangeEmailMachine(e.auth.client),[e]),u=t.useInterpret(n),S=t.useSelector(u,r=>r.matches("requesting")),a=t.useSelector(u,r=>r.context.error),h=t.useSelector(u,r=>r.matches("idle.error")),d=t.useSelector(u,r=>r.matches("idle.success"));return{changeEmail:p.useCallback(async(r,c=s)=>g.changeEmailPromise(u,r,c),[u,s]),isLoading:S,needsEmailVerification:d,isError:h,error:a}}const V=()=>{const s=f(),e=p.useMemo(()=>g.createChangePasswordMachine(s.auth.client),[s]),n=t.useInterpret(e),u=t.useSelector(n,o=>o.matches({idle:"error"})),S=t.useSelector(n,o=>o.matches({idle:"success"})),a=t.useSelector(n,o=>o.context.error),h=t.useSelector(n,o=>o.matches("requesting"));return{changePassword:o=>g.changePasswordPromise(n,o),isLoading:h,isSuccess:S,isError:u,error:a}},F=()=>{const s=f(),e=p.useMemo(()=>g.createEnableMfaMachine(s.auth.client),[s]),n=t.useInterpret(e),u=t.useSelector(n,i=>i.matches({idle:"error"})||i.matches({generated:{idle:"error"}})),S=t.useSelector(n,i=>i.matches("generating")),a=t.useSelector(n,i=>i.matches("generated")),h=t.useSelector(n,i=>i.matches({generated:"activating"})),d=t.useSelector(n,i=>i.matches({generated:"activated"})),o=t.useSelector(n,i=>i.context.error),r=t.useSelector(n,i=>i.context.imageUrl||"");return{generateQrCode:()=>g.generateQrCodePromise(n),isGenerating:S,qrCodeDataUrl:r,isGenerated:a,activateMfa:i=>g.activateMfaPromise(n,i),isActivating:h,isActivated:d,isError:u,error:o}},w=()=>{const s=U();return s?O(s):null},T=s=>{const e=f(),n=E=>{s.send({type:"ADD",file:E.file,bucketId:E.bucketId||i})},u=E=>g.uploadFilePromise({url:e.storage.url,accessToken:e.auth.getAccessToken(),adminSecret:e.adminSecret,...E},s),S=()=>{s.send("CANCEL")},a=()=>{s.send("DESTROY")},h=t.useSelector(s,E=>E.matches("uploading")),d=t.useSelector(s,E=>E.matches("uploaded")),o=t.useSelector(s,E=>E.matches("error")),r=t.useSelector(s,E=>E.context.error||null),c=t.useSelector(s,E=>E.context.progress),l=t.useSelector(s,E=>E.context.id),i=t.useSelector(s,E=>E.context.bucketId),m=t.useSelector(s,E=>{var I;return(I=E.context.file)==null?void 0:I.name});return{add:n,upload:u,cancel:S,destroy:a,isUploaded:d,isUploading:h,isError:o,error:r,progress:c,id:l,bucketId:i,name:m}},_=()=>{const s=t.useInterpret(g.createFileUploadMachine);return T(s)},C=()=>{const s=w();return(s==null?void 0:s["https://hasura.io/jwt/claims"])||null},q=s=>{const e=C();return(e==null?void 0:e[s.startsWith("x-hasura-")?s:`x-hasura-${s}`])||null},H=()=>{const s=f(),[e,n]=p.useState([]),u=t.useInterpret(g.createMultipleFilesUploadMachine,{},m=>{m.event.type==="UPLOAD_ERROR"?n(m.context.files.filter(E=>{var I;return(I=E.getSnapshot())==null?void 0:I.context.error})):(m.matches("uploaded")||m.event.type==="CLEAR")&&e.length>0&&n([])}),S=m=>{u.send({type:"ADD",...m})},a=m=>g.uploadMultipleFilesPromise({url:s.storage.url,accessToken:s.auth.getAccessToken(),adminSecret:s.adminSecret,...m},u),h=()=>{u.send("CANCEL")},d=()=>{u.send("CLEAR")},o=t.useSelector(u,m=>m.matches("uploading")),r=t.useSelector(u,m=>m.matches("uploaded")),c=t.useSelector(u,m=>m.matches("error")),l=t.useSelector(u,m=>m.context.progress),i=t.useSelector(u,m=>m.context.files);return{upload:a,add:S,clear:d,cancel:h,progress:l,isUploaded:r,isUploading:o,files:i,isError:c,errors:e}},j=s=>{const[e,n]=p.useState(!0);p.useEffect(()=>{n(!1)},[]);const u=p.useContext(v);return new Proxy({},{get(S,a){return g.encodeQueryParameters(`${u.auth.client.backendUrl}/signin/provider/${a}`,g.rewriteRedirectTo(e?void 0:u.auth.client.clientUrl,s))}})},Q=s=>{const e=f(),n=p.useMemo(()=>g.createResetPasswordMachine(e.auth.client),[e]),u=t.useInterpret(n),S=t.useSelector(u,r=>r.matches("requesting")),a=t.useSelector(u,r=>r.context.error),h=t.useSelector(u,r=>r.matches("idle.error")),d=t.useSelector(u,r=>r.matches("idle.success"));return{resetPassword:(r,c=s)=>g.resetPasswordPromise(u,r,c),isLoading:S,isSent:d,isError:h,error:a}},J=s=>{const e=f(),n=p.useMemo(()=>g.createSendVerificationEmailMachine(e.auth.client),[e]),u=t.useInterpret(n),S=t.useSelector(u,r=>r.matches({idle:"error"})),a=t.useSelector(u,r=>r.matches({idle:"success"})),h=t.useSelector(u,r=>r.context.error),d=t.useSelector(u,r=>r.matches("requesting"));return{sendEmail:(r,c=s)=>g.sendVerificationEmailPromise(u,r,c),isLoading:d,isSent:a,isError:S,error:h}},Y=()=>{const s=P(),e=()=>g.signInAnonymousPromise(s),n=t.useSelector(s,o=>o.context.errors.authentication||null,(o,r)=>(o==null?void 0:o.error)===(r==null?void 0:r.error)),u=t.useSelector(s,o=>o.matches({authentication:{authenticating:"anonymous"}})),S=t.useSelector(s,o=>o.matches({authentication:"signedIn"})),a=t.useSelector(s,o=>o.matches({authentication:{signedOut:"failed"}})),h=t.useSelector(s,o=>o.context.user,(o,r)=>(o==null?void 0:o.id)===(r==null?void 0:r.id));return{accessToken:t.useSelector(s,o=>o.context.accessToken.value),error:n,isError:a,isLoading:u,isSuccess:S,signInAnonymous:e,user:h}},$=()=>{const s=P(),e=(i,m)=>g.signInEmailPasswordPromise(s,i,m),n=i=>g.signInMfaTotpPromise(s,i),u=t.useSelector(s,i=>i.context.user,(i,m)=>(i==null?void 0:i.id)===(m==null?void 0:m.id)),S=t.useSelector(s,i=>i.context.accessToken.value),a=t.useSelector(s,i=>i.context.errors.authentication||null,(i,m)=>(i==null?void 0:i.error)===(m==null?void 0:m.error)),h=t.useSelector(s,i=>i.matches({authentication:"signedIn"})),d=t.useSelector(s,i=>i.matches({authentication:{authenticating:"password"}}),(i,m)=>i===m),o=t.useSelector(s,i=>i.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(i,m)=>i===m),r=t.useSelector(s,i=>i.matches({authentication:{signedOut:"needsMfa"}}),(i,m)=>i===m),c=t.useSelector(s,i=>i.matches({authentication:{signedOut:"failed"}}),(i,m)=>i===m),l=t.useSelector(s,i=>i.context.mfa);return{accessToken:S,error:a,isError:c,isLoading:d,isSuccess:h,needsEmailVerification:o,needsMfaOtp:r,mfa:l,sendMfaOtp:n,signInEmailPassword:e,user:u}};function G(s){const e=P(),n=(d,o=s)=>g.signInEmailPasswordlessPromise(e,d,o),u=t.useSelector(e,d=>d.context.errors.registration||null,(d,o)=>(d==null?void 0:d.error)===(o==null?void 0:o.error)),S=t.useSelector(e,d=>d.matches("registration.passwordlessEmail")),a=t.useSelector(e,d=>d.matches("registration.incomplete.needsEmailVerification")),h=t.useSelector(e,d=>d.matches("registration.incomplete.failed"));return{signInEmailPasswordless:n,isLoading:S,isSuccess:a,isError:h,error:u}}const W=()=>{const s=P(),e=r=>g.signInEmailSecurityKeyPromise(s,r),n=t.useSelector(s,r=>r.context.user,(r,c)=>(r==null?void 0:r.id)===(c==null?void 0:c.id)),u=t.useSelector(s,r=>r.context.accessToken.value),S=t.useSelector(s,r=>r.context.errors.authentication||null,(r,c)=>(r==null?void 0:r.error)===(c==null?void 0:c.error)),a=t.useSelector(s,r=>r.matches({authentication:"signedIn"})),h=t.useSelector(s,r=>r.matches({authentication:{authenticating:"securityKeyEmail"}}),(r,c)=>r===c),d=t.useSelector(s,r=>r.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}}),(r,c)=>r===c),o=t.useSelector(s,r=>r.matches({authentication:{signedOut:"failed"}}),(r,c)=>r===c);return{accessToken:u,error:S,isError:o,isLoading:h,isSuccess:a,needsEmailVerification:d,signInEmailSecurityKey:e,user:n}},z=()=>{const s=P(),e=o=>g.signInPATPromise(s,o),n=t.useSelector(s,o=>o.context.user,(o,r)=>(o==null?void 0:o.id)===(r==null?void 0:r.id)),u=t.useSelector(s,o=>o.context.accessToken.value),S=t.useSelector(s,o=>o.context.errors.authentication||null,(o,r)=>(o==null?void 0:o.error)===(r==null?void 0:r.error)),a=t.useSelector(s,o=>o.matches({authentication:"signedIn"})),h=t.useSelector(s,o=>o.matches({authentication:{authenticating:"password"}}),(o,r)=>o===r),d=t.useSelector(s,o=>o.matches({authentication:{signedOut:"failed"}}),(o,r)=>o===r);return{accessToken:u,error:S,isError:d,isLoading:h,isSuccess:a,signInPAT:e,user:n}};function B(s){const e=P(),[n,u]=p.useState(""),S=(l,i=s)=>(u(l),g.signInSmsPasswordlessPromise(e,l,i)),a=async(...l)=>{if(l.length===2){const[m,E]=l;return g.signInSmsPasswordlessOtpPromise(e,m,E)}const[i]=l;return g.signInSmsPasswordlessOtpPromise(e,n,i)},h=t.useSelector(e,l=>l.context.errors.registration||null,(l,i)=>(l==null?void 0:l.error)===(i==null?void 0:i.error)),d=t.useSelector(e,l=>l.matches("registration.passwordlessSms")||l.matches("registration.passwordlessSmsOtp")),o=t.useSelector(e,l=>l.matches("authentication.signedIn")),r=t.useSelector(e,l=>l.matches("registration.incomplete.needsOtp")),c=t.useSelector(e,l=>l.matches("registration.incomplete.failed"));return{signInSmsPasswordless:S,sendOtp:a,isLoading:d,isSuccess:o,needsOtp:r,isError:c,error:h}}const X=(s=!1)=>{const e=P(),n=a=>g.signOutPromise(e,typeof a=="boolean"?a:s),u=t.useSelector(e,a=>a.matches({authentication:{signedOut:"success"}}),(a,h)=>a===h),S=t.useSelector(e,a=>a.context.errors.signout||null,(a,h)=>(a==null?void 0:a.error)===(h==null?void 0:h.error));return{signOut:n,isSuccess:u,error:S}},Z=s=>{const e=P(),n=t.useSelector(e,c=>!!c.context.errors.registration),u=t.useSelector(e,c=>c.context.errors.registration||null,(c,l)=>(c==null?void 0:c.error)===(l==null?void 0:l.error)),S=t.useSelector(e,c=>c.matches("registration.emailPassword")),a=t.useSelector(e,c=>c.matches("registration.incomplete.needsEmailVerification")),h=t.useSelector(e,c=>c.matches({authentication:"signedIn",registration:"complete"})),d=(c,l,i=s)=>g.signUpEmailPasswordPromise(e,c,l,i),o=t.useSelector(e,c=>c.context.user,(c,l)=>(c==null?void 0:c.id)===(l==null?void 0:l.id));return{accessToken:t.useSelector(e,c=>c.context.accessToken.value),error:u,isError:n,isLoading:S,isSuccess:h,needsEmailVerification:a,signUpEmailPassword:d,user:o}},b=s=>{const e=P(),n=t.useSelector(e,c=>!!c.context.errors.registration),u=t.useSelector(e,c=>c.context.errors.registration||null,(c,l)=>(c==null?void 0:c.error)===(l==null?void 0:l.error)),S=t.useSelector(e,c=>c.matches("registration.securityKey")),a=t.useSelector(e,c=>c.matches("registration.incomplete.needsEmailVerification")),h=t.useSelector(e,c=>c.matches({authentication:"signedIn",registration:"complete"})),d=(c,l=s)=>g.signUpEmailSecurityKeyPromise(e,c,l),o=t.useSelector(e,c=>c.context.user,(c,l)=>(c==null?void 0:c.id)===(l==null?void 0:l.id));return{accessToken:t.useSelector(e,c=>c.context.accessToken.value),error:u,isError:n,isLoading:S,isSuccess:h,needsEmailVerification:a,signUpEmailSecurityKey:d,user:o}},ee=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.avatarUrl},(e,n)=>e===n)},se=()=>{const s=P();return t.useSelector(s,e=>e.context.user,(e,n)=>(e&&JSON.stringify(e))===(n&&JSON.stringify(n)))},te=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.defaultRole},(e,n)=>e===n)},ne=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.displayName},(e,n)=>e===n)},re=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.email},(e,n)=>e===n)},oe=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.id},(e,n)=>e===n)},ce=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.isAnonymous},(e,n)=>e===n)},ie=()=>{const s=P();return t.useSelector(s,e=>{var n;return(n=e.context.user)==null?void 0:n.locale},(e,n)=>e===n)},ue=()=>{const s=P();return t.useSelector(s,e=>{var n;return e.matches("authentication.signedIn")?((n=e.context.user)==null?void 0:n.roles)||[]:[]})};Object.defineProperty(exports,"NHOST_REFRESH_TOKEN_KEY",{enumerable:!0,get:()=>g.NHOST_REFRESH_TOKEN_KEY});exports.NhostClient=k;exports.NhostProvider=A;exports.NhostReactContext=v;exports.NhostReactProvider=N;exports.SignedIn=M;exports.SignedOut=R;exports.VanillaNhostClient=y;exports.useAccessToken=U;exports.useAddSecurityKey=L;exports.useAuthInterpreter=P;exports.useAuthenticated=D;exports.useAuthenticationStatus=x;exports.useChangeEmail=K;exports.useChangePassword=V;exports.useConfigMfa=F;exports.useDecodedAccessToken=w;exports.useFileUpload=_;exports.useFileUploadItem=T;exports.useHasuraClaim=q;exports.useHasuraClaims=C;exports.useMultipleFilesUpload=H;exports.useNhostClient=f;exports.useProviderLink=j;exports.useResetPassword=Q;exports.useSendVerificationEmail=J;exports.useSignInAnonymous=Y;exports.useSignInEmailPassword=$;exports.useSignInEmailPasswordless=G;exports.useSignInEmailSecurityKey=W;exports.useSignInPAT=z;exports.useSignInSmsPasswordless=B;exports.useSignOut=X;exports.useSignUpEmailPassword=Z;exports.useSignUpEmailSecurityKeyEmail=b;exports.useUserAvatarUrl=ee;exports.useUserData=se;exports.useUserDefaultRole=te;exports.useUserDisplayName=ne;exports.useUserEmail=re;exports.useUserId=oe;exports.useUserIsAnonymous=ce;exports.useUserLocale=ie;exports.useUserRoles=ue;
//# sourceMappingURL=index.cjs.js.map
