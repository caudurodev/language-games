"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const m=require("isomorphic-unfetch"),u=require("graphql");function g(r,e,t){return r.document?r:{document:r,variables:e,config:t}}function c(r){var s;let e;const t=r.definitions.filter(o=>o.kind==="OperationDefinition");return t.length===1&&(e=(s=t[0].name)==null?void 0:s.value),e}function y(r){if(typeof r=="string"){let t;try{const s=u.parse(r);t=c(s)}catch{}return{query:r,operationName:t}}const e=c(r);return{query:u.print(r),operationName:e}}class q{constructor(e){const{url:t,adminSecret:s}=e;this._url=t,this.accessToken=null,this.adminSecret=s}async request(e,...t){const[s,o]=t,l=g(e,s,o),{headers:h,...p}=o||{},{query:d,operationName:f}=y(l.document);try{const a=await m(this.httpUrl,{method:"POST",body:JSON.stringify({operationName:f,query:d,variables:s}),headers:{"Content-Type":"application/json",...this.generateAccessTokenHeaders(),...h},...p});if(!a.ok)return{data:null,error:{error:a.statusText,message:a.statusText,status:a.status}};const{data:n,errors:i}=await a.json();return i?{data:null,error:i}:typeof n!="object"||Array.isArray(n)||n===null?{data:null,error:{error:"invalid-response",message:"incorrect response data from GraphQL server",status:0}}:{data:n,error:null}}catch(a){const n=a;return{data:null,error:{message:n.message,status:n.name==="AbortError"?0:500,error:n.name==="AbortError"?"abort-error":"unknown"}}}}get httpUrl(){return this._url}get wsUrl(){return this._url.replace(/^(http)(s?):\/\//,"ws$2://")}get url(){return this._url}getUrl(){return this._url}setAccessToken(e){if(!e){this.accessToken=null;return}this.accessToken=e}generateAccessTokenHeaders(){return this.adminSecret?{"x-hasura-admin-secret":this.adminSecret}:this.accessToken?{Authorization:`Bearer ${this.accessToken}`}:{}}}exports.NhostGraphqlClient=q;
//# sourceMappingURL=index.cjs.js.map
